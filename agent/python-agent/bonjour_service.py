from zeroconf import ServiceInfo, Zeroconf\nimport socket\n\nclass BonjourPublisher:\n    def __init__(self, port):\n        self.port = port\n        self.zeroconf = None\n        self.info = None\n    \n    def start(self):\n        \"\"\"启动 Bonjour 服务发布\"\"\"\n        try:\n            self.zeroconf = Zeroconf()\n            \n            hostname = socket.gethostname()\n            \n            # 获取本机 IP 地址\n            s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n            try:\n                s.connect(("8.8.8.8", 80))\n                ip_address = s.getsockname()[0]\n            except:\n                ip_address = "127.0.0.1"\n            finally:\n                s.close()\n            \n            # 注册服务\n            self.info = ServiceInfo(\n                "_macmonitor._tcp.local.",\n                f"{hostname}._macmonitor._tcp.local.",\n                addresses=[socket.inet_aton(ip_address)],\n                port=self.port,\n                properties={\n                    "version": "1.0",\n                    "platform": "python"\n                },\n                server=f"{hostname}.local."\n            )\n            \n            self.zeroconf.register_service(self.info)\n            print(f"✅ Bonjour service published: {hostname} at {ip_address}:{self.port}")\n        except Exception as e:\n            print(f"❌ Failed to publish Bonjour service: {e}")\n    \n    def stop(self):\n        \"\"\"停止 Bonjour 服务\"\"\"\n        if self.zeroconf and self.info:\n            self.zeroconf.unregister_service(self.info)\n            self.zeroconf.close()\n            print("Bonjour service stopped")\n